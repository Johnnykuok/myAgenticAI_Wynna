<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown渲染测试</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <div class="main-content">
            <div class="chat-container">
                <div class="chat-messages">
                    <div class="message bot-message">
                        <div class="message-content" id="test-content">
                            <!-- 测试内容将在这里插入 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 复制script.js中的formatMessage函数
        function formatMessage(content) {
            let formatted = content;
            
            // 首先处理图片 ![alt](src)
            formatted = formatted.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, (match, alt, src) => {
                return `<div class="image-container">
                            <img src="${src}" alt="${alt}" class="message-image" loading="lazy" onerror="this.style.display='none';">
                            ${alt ? `<div class="image-caption">${alt}</div>` : ''}
                        </div>`;
            });
            
            // 处理链接 [text](url) - 在处理标题之前，避免链接被误处理
            formatted = formatted.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>');
            
            // 处理各级标题 - 按层级从高到低处理，避免冲突
            formatted = formatted.replace(/^##### (.*$)/gm, '<h5>$1</h5>');
            formatted = formatted.replace(/^#### (.*$)/gm, '<h4>$1</h4>');
            formatted = formatted.replace(/^### (.*$)/gm, '<h3>$1</h3>');
            formatted = formatted.replace(/^## (.*$)/gm, '<h2>$1</h2>');
            formatted = formatted.replace(/^# (.*$)/gm, '<h1>$1</h1>');
            
            // 处理粗体和斜体
            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // 处理代码块
            formatted = formatted.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>');
            formatted = formatted.replace(/`([^`]+)`/g, '<code>$1</code>');
            
            // 处理列表项
            formatted = formatted.replace(/^\* (.*$)/gm, '<li>$1</li>');
            formatted = formatted.replace(/^- (.*$)/gm, '<li>$1</li>');
            formatted = formatted.replace(/^\d+\. (.*$)/gm, '<li>$1</li>');
            
            // 包装连续的列表项为ul标签
            formatted = formatted.replace(/(<li>.*?<\/li>(?:\s*<br>\s*<li>.*?<\/li>)*)/gs, (match) => {
                // 移除li标签之间的br标签
                const cleanMatch = match.replace(/<br>\s*(?=<li>)/g, '');
                return `<ul>${cleanMatch}</ul>`;
            });
            
            // 处理换行 - 在所有其他处理完成后
            formatted = formatted.replace(/\n/g, '<br>');
            
            return formatted;
        }

        // 测试文本，包含####格式
        const testContent = `### **一、住宿区域选择**  
根据建议，首尔8月行程可考虑选择**江南区**等交通便利且配套设施完善的区域，方便出行和日常活动。


### **二、首尔主要景点游览顺序规划（以5天行程为例）**  
#### **Day 1：景福宫-北村韩屋村-三清洞**  
- 上午：参观**景福宫**，感受朝鲜王朝建筑与历史，可游览勤政殿、康宁殿等建筑。  
- 中午：在北村韩屋村附近品尝韩定食（传统韩式正餐）。  
- 下午：漫步**北村韩屋村**，体验韩屋风情并拍照打卡，随后前往**三清洞**，感受韩系文艺氛围，这里有众多文艺小店和咖啡馆。  

#### **Day 2：明洞-南山塔**  
- 上午：前往**明洞**，这里是首尔著名购物街，有时尚品牌、美妆集合店等，还可品尝韩式小吃。  
- 下午：前往**南山塔**，可乘坐缆车或步行上山，登顶后俯瞰首尔全景，参观N首尔塔、爱情锁墙等。  
- 晚上：在南山塔下餐厅用餐，欣赏绝美夜景。  

#### **Day 3：北汉山国立公园**  
选择一日游或自行前往北汉山（可通过地铁到达），体验徒步登山，欣赏自然风景，感受韩国近郊的宁静与绿意。  


### **三、首尔交通线路及票务信息**  
首尔交通主要有地铁、公交、出租车等，其中地铁是最常用的交通方式。`;

        // 应用格式化并显示
        document.getElementById('test-content').innerHTML = formatMessage(testContent);
    </script>
</body>
</html>